const e=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),t=e=>!!e.tagName,n=e=>"object"==typeof e&&!Array.isArray(e),s=e=>{const t=-e.getTimezoneOffset(),n=t>=0?"+":"-",s=e=>(e<10?"0":"")+e;return e.getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+"T"+s(e.getHours())+":"+s(e.getMinutes())+":"+s(e.getSeconds())+n+s(Math.floor(Math.abs(t)/60))+":"+s(Math.abs(t)%60)};var i={};function r(e,t,n,s){Object.defineProperty(e,t,{get:n,set:s,enumerable:!0,configurable:!0})}let a;var o;r(i,"render",(()=>q)),r(i,"createVirtualElement",(()=>k)),r(i,"e",(()=>N)),r(i,"useEffect",(()=>b)),r(i,"useState",(()=>w)),(o=a||(a={}))[o.Element=1]="Element",o[o.Text=3]="Text";const u=Object.keys,l=e=>"function"==typeof e.type,c=e=>!(e=>"String"===e.type)(e)&&!l(e),p=e=>e.nodeType===a.Text,d=(e,t)=>{t&&e.parentElement?.replaceChild(t,e)};let m,S;const h={useState:new Map,useEffect:new Map},b=(e,t)=>{const n=h.useEffect.get(m)||[];n.push({callback:e,dependencies:t,unmountCallback:void 0}),h.useEffect.set(m,n)},w=e=>{let t=h.useState.get(m);t||(t=[{value:e}],h.useState.set(m,t));const n=t[t.length-1];return[n.value,e=>{n.value!==e&&(n.value=e,requestIdleCallback(S))}]},f=(e,t)=>{m=e.type,S=t;const n=h.useEffect.get(e.type);h.useEffect.delete(e.type),e.result=e.type(e.props);const s=h.useEffect.get(m);return s&&0!==s.length?(s.forEach(((e,t)=>{const s=n?.[t];s&&((e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0})(s.dependencies,e.dependencies)?e.unmountCallback=s.unmountCallback:e.unmountCallback=e.callback()})),e.result):e.result},y=e=>{(e=>{void 0===e.requestIdleCallback&&(e.requestIdleCallback=(e,t)=>setTimeout(e,0))})(e)};let g;var v;(v=g||(g={})).Value="value",v.ClassName="className";const T=new Set(Object.values(g)),B=new Map([["onInput","input"],["onClick","click"]]);function k(e,t,...n){return"function"==typeof e?{type:e,props:t||{},result:null}:{type:e,props:{...t,tagName:e||"div"},children:n.map((e=>"string"==typeof e?{type:"String",value:e}:e))}}const N=k,x=(e,t,n,s)=>{n!==s&&(n&&e.removeEventListener(t,n),s&&e.addEventListener(t,s))},E=(e,t,n)=>{if("String"===t?.type||"String"===n?.type)return;const s=t?u(t.props):[],i=n?u(n.props):[];for(const r of i.concat(s)){const s=t?.props[r],i=n?.props[r];if(T.has(r))e[r]=void 0===i?"":i;else if(s!==i)if("onClick"!==r&&"onInput"!==r)"boolean"==typeof i?i?e.setAttribute(r,""):e.removeAttribute(r):void 0===i?e.removeAttribute(r):e.setAttribute(r,String(i));else{const s=B.get(r);s&&x(e,s,t?.props[r],n?.props[r])}}},I=e=>{if(!e)return null;if("String"===e.type)return P.createTextNode(e.value);if(l(e))return I(f(e,A));const{children:t,type:n}=e,s=P.createElement(n);E(s,null,e);for(const e of t){if(!e)continue;const t=I(e);t&&s.appendChild(t)}return s},$=(e,t,n)=>{t.value!==n.value&&(e.nodeType===a.Element?d(e,I(n)):p(e)&&e.replaceData(0,e.length,n.value))},C=(e,t,n)=>{if(n){if(!t||t.type!==n.type)return t&&l(t)&&(e=>{const t=h.useEffect.get(e.type);if(!t)return e.result;for(const{unmountCallback:e}of t)e&&e();h.useEffect.delete(e.type),h.useState.delete(e.type),e.result})(t),void d(e,I(n));if("String"!==t.type||"String"!==n.type){if(p(e))d(e,I(n));else if(l(t)&&l(n))C(e,t.result,f(n,A));else if(c(t)&&c(n)){E(e,t,n);const s=Array.from(e.childNodes).filter((e=>e.nodeType===a.Element||e.nodeType===a.Text));n.children.forEach(((n,i)=>{const r=s[i];if(r)C(r,t.children[i],n);else if(n){const t=I(n);t&&e.appendChild(t)}}))}}else $(e,t,n)}else e.remove()};let A,P,D=k("div"),M=!1;const q=(e,t)=>{P=t.ownerDocument,!M&&P.defaultView&&(y(P.defaultView),M=!0);const n=k("div",null,e);A=()=>q(e,t),C(t,D,n),D=n};let O,_;!function(e){e.Development="development",e.Production="production"}(O||(O={})),function(e){e.Intro="intro",e.NewSession="new-session",e.ShowSession="show-session"}(_||(_={}));const j=e=>e?"new"===e?_.NewSession:_.ShowSession:_.Intro,F={app:(()=>{const e=window.localStorage.getItem("pokerTracker"),t=e?JSON.parse(e):{},n=(()=>{const e=window.location.hash.match(/#\/sessions\/(.+)/);if(e)return e[1]})();return{screen:j(n),sessions:{},currentSessionId:n,showSessionScreen:{rebuyAmount:"",notes:"",cashoutAmount:"",adminPassword:"",isSavingSession:!1},newSessionScreen:{casinoName:"",smallBlind:"",bigBlind:"",maxBuyin:""},...t}})()},L=e=>{F.app=new Proxy(F.app,{get(e,t,n){if(!Reflect.has(e,t))return;const s=Reflect.get(e,t,n);return"object"==typeof s&&null!==s?new Proxy(s,this):s},set(t,n,s,i){const r=Reflect.set(t,n,s,i);return r&&e(),r}}),e()},R=()=>{window.localStorage.setItem("pokerTracker",JSON.stringify({sessions:F.app.sessions,cachedAdminPassword:F.app.cachedAdminPassword}))},V=()=>{const e=(e=>{switch(e){case _.Intro:return U;case _.NewSession:return K;case _.ShowSession:return Q;default:throw new Error(`Unknown screen ${F.app.screen}`)}})(F.app.screen);return i.e("div",{className:"app"},i.e(e),i.e(ee))},J=({smallBlind:e,bigBlind:t})=>i.e("button",{type:"button",className:"prefill-blinds","data-small-blind":e,"data-big-blind":t},`${e}/${t}`),U=()=>i.e("div",{id:"intro-screen",className:"screen"},i.e("button",{id:"new-session-button"},"Start Session"));class z{static create(t,n,s,i){const r=e();return F.app.sessions[r]={id:e(),casinoName:t,smallBlind:n,bigBlind:s,maxBuyin:i,notes:"",cashoutAmount:0,dealerTips:0,drinkTips:0,buyins:[]},new this(r)}constructor(e){if(this.id=e,!this.attributes)throw new Error(`Session ${e} does not exist`)}get attributes(){return F.app.sessions[this.id]}get startTime(){return this.attributes.startTime?new Date(this.attributes.startTime):null}get endTime(){return this.attributes.endTime?new Date(this.attributes.endTime):null}start(){if(this.startTime)throw new Error("Session already started");if(this.endTime)throw new Error("Session already ended");this.attributes.startTime=s(new Date),this.attributes.buyins.push({amount:this.attributes.maxBuyin,time:this.attributes.startTime})}rebuy(e){this.attributes.buyins.push({amount:e,time:(new Date).toISOString()})}rebuyMax(){this.rebuy(this.attributes.maxBuyin)}end(e,t){this.attributes.cashoutAmount=e,this.attributes.endTime=s(new Date),this.attributes.notes=t}undoEnd(){this.attributes.cashoutAmount=0,delete this.attributes.endTime}buyinsTotal(){return this.attributes.buyins.reduce(((e,t)=>e+t.amount),0)}updateTip(e,t){this.attributes[e]+t<0||(this.attributes[e]+=t)}updateDealerTip(e){this.updateTip("dealerTips",e)}updateDrinkTip(e){this.updateTip("drinkTips",e)}}const H=new class{constructor(e){this.appState=e}get currentSession(){return this.appState.currentSessionId&&this._cachedCurrentSessionId!==this.appState.currentSessionId&&(this._cachedCurrentSessionId=this.appState.currentSessionId,this._cachedCurrentSession=new z(this.appState.currentSessionId)),this._cachedCurrentSession}get mostFrequentCasinoName(){if(this._cachedMostFrequentCasinoName)return this._cachedMostFrequentCasinoName;const e=Object.values(this.appState.sessions).sort(((e,t)=>e.endTime&&t.endTime?Date.parse(t.endTime)-Date.parse(e.endTime):1))[0]?.casinoName;return e&&(this._cachedMostFrequentCasinoName=e),e}}(F.app),K=()=>i.e("div",{id:"new-session-screen",className:"screen"},i.e(X,{onSelect:e=>{F.app.newSessionScreen.casinoName=e}}),i.e("form",{id:"new-session-form"},i.e("div",null,i.e("label",null,i.e("span",null,"Casino Name"),i.e("input",{id:"casino-name-input",type:"text",placeholder:H.mostFrequentCasinoName??"Bellagio",required:!0,value:F.app.newSessionScreen.casinoName}))),i.e("div",null,i.e("label",null,i.e("span",null,"Blinds"),i.e(Y,{id:"small-blind-input",placeholder:"2",value:F.app.newSessionScreen.smallBlind,max:100}),i.e(Y,{id:"big-blind-input",placeholder:"5",value:F.app.newSessionScreen.bigBlind,max:200})),i.e(J,{smallBlind:1,bigBlind:2}),i.e(J,{smallBlind:1,bigBlind:3}),i.e(J,{smallBlind:2,bigBlind:5}),i.e(J,{smallBlind:5,bigBlind:10})),i.e("div",null,i.e("label",null,i.e("span",null,"Max Buyin"),i.e(Y,{id:"max-buyin-input",placeholder:"500",value:F.app.newSessionScreen.maxBuyin}))),i.e("div",null,i.e("input",{type:"submit",value:"Start Session"})))),Y=({id:e,placeholder:t,value:n,min:s=1,max:r,onInput:a})=>i.e("input",{id:e,type:"number",placeholder:t,pattern:"\\d*",value:n,min:s,max:r,required:!0,onInput:a});class G{constructor(e){this.session=e}drinkTips(){return`$${this.session.attributes.drinkTips??0}`}dealerTips(){return`$${this.session.attributes.dealerTips??0}`}blinds(){return`${this.session.attributes.smallBlind}/${this.session.attributes.bigBlind}`}maxBuyin(){return`$${this.session.attributes.maxBuyin} max`}title(){return[this.session.attributes.casinoName,this.blinds(),this.maxBuyin()].join(" ")}startTime(){return this.session.startTime?.toLocaleString()??""}profit(){return((this.session.attributes.cashoutAmount??0)-this.session.buyinsTotal()).toString()}}const Q=()=>{if(!H.currentSession)return null;const e=new G(H.currentSession);return i.e("div",{id:"show-session-screen",className:"screen"},i.e("h1",{id:"session-title"},e.title()),i.e("div",null,i.e("span",null,`Profit: $${e.profit()}`)),i.e("div",null,i.e("span",null,`Start time: ${e.startTime()}`)),H.currentSession.startTime&&i.e("div",null,i.e("span",null,"Time elapsed: ",i.e(Z,{startTime:H.currentSession.startTime}))),i.e("form",{id:"rebuy-form",className:"section"},i.e(Y,{id:"rebuy-amount-input",placeholder:H.currentSession.attributes.maxBuyin.toString(),value:F.app.showSessionScreen.rebuyAmount}),i.e("input",{type:"submit",value:"Rebuy"}),i.e("input",{id:"rebuy-max-button",type:"button",value:"Max"})),i.e(W,{type:"dealer",value:e.dealerTips()}),i.e(W,{type:"drink",value:e.drinkTips()}),i.e("form",{id:"end-session-form",className:"section"},i.e("input",{className:"hidden",type:"text",autocomplete:"username"}),i.e("label",{className:"section"},i.e("div",null,"Notes"),i.e("textarea",{onInput:e=>{e.target&&(F.app.showSessionScreen.notes=e.target.value)}})),i.e("label",{className:"section"},i.e("div",null,"Cashout Amount"),i.e(Y,{min:0,value:F.app.showSessionScreen.cashoutAmount,placeholder:(3*H.currentSession.attributes.maxBuyin).toString(),onInput:e=>{e.target&&(F.app.showSessionScreen.cashoutAmount=e.target.value)}})),F.app.cachedAdminPassword?"":i.e("div",{id:"admin-password-area"},i.e("label",null,i.e("span",null,"Password")),i.e("input",{id:"admin-password-input",type:"password",autocomplete:"current-password",required:!0})),i.e("input",{id:"end-session-submit-button",type:"submit",value:"End Session",disabled:F.app.showSessionScreen.isSavingSession})))},W=({type:e,value:t})=>{return i.e("div",{className:"section"},i.e("span",null,`${n=e,`${n[0].toUpperCase()}${n.slice(1)}`} tips: ${t}`),i.e("div",null,i.e("button",{className:"tip-button",id:`decrement-${e}-tip-button`},"-"),i.e("button",{className:"tip-button",id:`increment-${e}-tip-button`},"+")));var n},X=({onSelect:e})=>{const t=H.mostFrequentCasinoName;return t?i.e("div",null,`Play at ${t} again?`,i.e("button",{onClick:()=>e(t)},"OK")):null},Z=({startTime:e})=>{const[t,n]=i.useState("");return i.useEffect((()=>{const t=()=>{n((e=>{let t=e/1e3;const n=Math.floor(t/3600),s=Math.floor((t-3600*n)/60);return t=Math.round(t-3600*n-60*s),`${n<10?`0${n}`:n.toString()}:${s<10?`0${s}`:s.toString()}:${t<10?`0${t}`:t.toString()}`})(Date.now()-e.getTime()))};setInterval(t,1e3),t()}),[]),i.e("span",null,t.toString())},ee=()=>{const[e,t]=i.useState(!1);return i.useEffect((()=>{setTimeout((()=>{t(!0)}),3e3)}),[]),i.e("div",{className:"app-footer "+(e?"invisible":"")},"Powered by ",i.e("a",{href:"https://github.com/mhluska/tortie",target:"_blank",rel:"noopener noreferrer"},"tortie"))},te="localhost"===window.location.hostname?O.Development:O.Production;const ne=()=>{const e=z.create(F.app.newSessionScreen.casinoName,parseInt(F.app.newSessionScreen.smallBlind),parseInt(F.app.newSessionScreen.bigBlind),parseInt(F.app.newSessionScreen.maxBuyin));e.start(),(e=>{window.history.pushState({},"",`#/sessions/${e.id}`),F.app.currentSessionId=e.id,F.app.screen=_.ShowSession})(e)},se=async()=>{if(!H.currentSession)return;let e;H.currentSession.end(parseFloat(F.app.showSessionScreen.cashoutAmount),F.app.showSessionScreen.notes),F.app.showSessionScreen.isSavingSession=!0;try{e=await oe.saveSession(H.currentSession,F.app.cachedAdminPassword??F.app.showSessionScreen.adminPassword)}finally{F.app.showSessionScreen.isSavingSession=!1}e.ok?(F.app.cachedAdminPassword||(F.app.cachedAdminPassword=F.app.showSessionScreen.adminPassword),alert("Success!"),window.history.pushState({},"","#"),F.app.screen=_.Intro):(alert("Something went wrong."),H.currentSession.undoEnd())},ie=e=>{if(t(e.target)){switch(e.target.id){case"new-session-button":return window.history.pushState({},"","#/sessions/new"),void(F.app.screen=_.NewSession);case"decrement-dealer-tip-button":return void H.currentSession?.updateDealerTip(-1);case"increment-dealer-tip-button":return void H.currentSession?.updateDealerTip(1);case"decrement-drink-tip-button":return void H.currentSession?.updateDrinkTip(-1);case"increment-drink-tip-button":return void H.currentSession?.updateDrinkTip(1);case"rebuy-max-button":return void H.currentSession?.rebuyMax()}var n,s,i;e.target.classList.contains("prefill-blinds")&&e.target.dataset.smallBlind&&e.target.dataset.bigBlind&&(s=e.target.dataset.smallBlind,i=e.target.dataset.bigBlind,F.app.newSessionScreen.smallBlind=s,F.app.newSessionScreen.bigBlind=i,n=(100*parseInt(e.target.dataset.bigBlind)).toString(),F.app.newSessionScreen.maxBuyin=n)}},re=e=>{if(t(e.target))switch(e.preventDefault(),e.target.id){case"new-session-form":ne();break;case"rebuy-form":H.currentSession&&(H.currentSession.rebuy(parseFloat(F.app.showSessionScreen.rebuyAmount)),F.app.showSessionScreen.rebuyAmount="");break;case"end-session-form":se()}},ae=e=>{if(!e.target.type)return;const t=(e=>{switch(e){case"casino-name-input":return"newSessionScreen.casinoName";case"small-blind-input":return"newSessionScreen.smallBlind";case"big-blind-input":return"newSessionScreen.bigBlind";case"max-buyin-input":return"newSessionScreen.maxBuyin";case"max-players-input":return"newSessionScreen.maxPlayers";case"rebuy-amount-input":return"showSessionScreen.rebuyAmount";case"admin-password-input":return"showSessionScreen.adminPassword"}})(e.target.id);return t?((e,t,s)=>{if(!t)return;const i=t.split("."),r=i.pop();if(r){for(const t of i){const s=e[t];if(!n(s))return;e=s}e[r]=s}})(F.app,t,e.target.value):void 0},oe=new class{origin(){return te===O.Development?"http://localhost:3000":"https://blackjack-trainer-api.herokuapp.com"}request(e,t,n){const s=`${this.origin()}/api/v1${e}`;return window.fetch(s,{method:n.method,headers:{...n.headers,"Content-Type":"application/json"},body:JSON.stringify(t)})}post(e,t,n){return this.request(e,t,{method:"POST",...n})}saveSession(e,t){return this.post("/poker_sessions",{data:{type:"poker_session",attributes:e.attributes}},{headers:{"Poker-Sessions-Admin-Password":t}})}},ue=document.getElementById("root");ue&&(L((()=>i.render(i.e(V),ue))),ue.addEventListener("click",ie),ue.addEventListener("submit",re),ue.addEventListener("input",ae)),setInterval(R,1e4),document.addEventListener("visibilitychange",R),window.onbeforeunload=R;
//# sourceMappingURL=index.d142aeab.js.map
