const e=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),t=e=>{const t=-e.getTimezoneOffset(),s=t>=0?"+":"-",n=e=>(e<10?"0":"")+e;return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+s+n(Math.floor(Math.abs(t)/60))+":"+n(Math.abs(t)%60)};var s={};function n(e,t,s,n){Object.defineProperty(e,t,{get:s,set:n,enumerable:!0,configurable:!0})}let i;var r;n(s,"render",(()=>D)),n(s,"createVirtualElement",(()=>T)),n(s,"e",(()=>k)),n(s,"useEffect",(()=>S)),n(s,"useState",(()=>h)),(r=i||(i={}))[r.Element=1]="Element",r[r.Text=3]="Text";const a=Object.keys,o=e=>"function"==typeof e.type,u=e=>!(e=>"String"===e.type)(e)&&!o(e),l=e=>e.nodeType===i.Text,p=(e,t)=>{t&&e.parentElement?.replaceChild(t,e)};let c,d;const m={useState:new Map,useEffect:new Map},S=(e,t)=>{const s=m.useEffect.get(c)||[];s.push({callback:e,dependencies:t,unmountCallback:void 0}),m.useEffect.set(c,s)},h=e=>{let t=m.useState.get(c);t||(t=[{value:e}],m.useState.set(c,t));const s=t[t.length-1];return[s.value,e=>{s.value!==e&&(s.value=e,requestIdleCallback(d))}]},b=(e,t)=>{c=e.type,d=t;const s=m.useEffect.get(e.type);m.useEffect.delete(e.type),e.result=e.type(e.props);const n=m.useEffect.get(c);return n&&0!==n.length?(n.forEach(((e,t)=>{const n=s?.[t];n&&((e,t)=>{if(e.length!==t.length)return!1;for(let s=0;s<e.length;s+=1)if(e[s]!==t[s])return!1;return!0})(n.dependencies,e.dependencies)?e.unmountCallback=n.unmountCallback:e.unmountCallback=e.callback()})),e.result):e.result},w=e=>{(e=>{void 0===e.requestIdleCallback&&(e.requestIdleCallback=(e,t)=>setTimeout(e,0))})(e)};let f;var g;(g=f||(f={})).Value="value",g.ClassName="className";const y=new Set(Object.values(f)),v=new Map([["onInput","input"],["onClick","click"]]);function T(e,t,...s){return"function"==typeof e?{type:e,props:t||{},result:null}:{type:e,props:{...t,tagName:e||"div"},children:s.map((e=>"string"==typeof e?{type:"String",value:e}:e))}}const k=T,N=(e,t,s,n)=>{s!==n&&(s&&e.removeEventListener(t,s),n&&e.addEventListener(t,n))},B=(e,t,s)=>{if("String"===t?.type||"String"===s?.type)return;const n=t?a(t.props):[],i=s?a(s.props):[];for(const r of i.concat(n)){const n=t?.props[r],i=s?.props[r];if(y.has(r))e[r]=void 0===i?"":i;else if(n!==i)if("onClick"!==r&&"onInput"!==r)"boolean"==typeof i?i?e.setAttribute(r,""):e.removeAttribute(r):void 0===i?e.removeAttribute(r):e.setAttribute(r,String(i));else{const n=v.get(r);n&&N(e,n,t?.props[r],s?.props[r])}}},I=e=>{if(!e)return null;if("String"===e.type)return $.createTextNode(e.value);if(o(e))return I(b(e,E));const{children:t,type:s}=e,n=$.createElement(s);B(n,null,e);for(const e of t){if(!e)continue;const t=I(e);t&&n.appendChild(t)}return n},C=(e,t,s)=>{t.value!==s.value&&(e.nodeType===i.Element?p(e,I(s)):l(e)&&e.replaceData(0,e.length,s.value))},x=(e,t,s)=>{if(s){if(!t||t.type!==s.type)return t&&o(t)&&(e=>{const t=m.useEffect.get(e.type);if(!t)return e.result;for(const{unmountCallback:e}of t)e&&e();m.useEffect.delete(e.type),m.useState.delete(e.type),e.result})(t),void p(e,I(s));if("String"!==t.type||"String"!==s.type){if(l(e))p(e,I(s));else if(o(t)&&o(s))x(e,t.result,b(s,E));else if(u(t)&&u(s)){B(e,t,s);const n=Array.from(e.childNodes).filter((e=>e.nodeType===i.Element||e.nodeType===i.Text));s.children.forEach(((s,i)=>{const r=n[i];if(r)x(r,t.children[i],s);else if(s){const t=I(s);t&&e.appendChild(t)}}))}}else C(e,t,s)}else e.remove()};let E,$,A=T("div"),P=!1;const D=(e,t)=>{$=t.ownerDocument,!P&&$.defaultView&&(w($.defaultView),P=!0);const s=T("div",null,e);E=()=>D(e,t),x(t,A,s),A=s};let M,q;!function(e){e.Development="development",e.Production="production"}(M||(M={})),function(e){e.Intro="intro",e.NewSession="new-session",e.ShowSession="show-session"}(q||(q={}));const O=e=>e?"new"===e?q.NewSession:q.ShowSession:q.Intro,_={app:(()=>{const e=window.localStorage.getItem("pokerTracker"),t=e?JSON.parse(e):{},s=(()=>{const e=window.location.hash.match(/#\/sessions\/(.+)/);if(e)return e[1]})();return{screen:O(s),sessions:{},currentSessionId:s,showSessionScreen:{rebuyAmount:"",notes:"",cashoutAmount:"",adminPassword:"",isSavingSession:!1},newSessionScreen:{casinoName:"",smallBlind:"",bigBlind:"",maxBuyin:""},...t}})()},F=e=>{_.app=new Proxy(_.app,{get(e,t,s){if(!Reflect.has(e,t))return;const n=Reflect.get(e,t,s);return"object"==typeof n&&null!==n?new Proxy(n,this):n},set(t,s,n,i){const r=Reflect.set(t,s,n,i);return r&&e(),r}}),e()},j=()=>{window.localStorage.setItem("pokerTracker",JSON.stringify({sessions:_.app.sessions,cachedAdminPassword:_.app.cachedAdminPassword}))},L=()=>{const e=(e=>{switch(e){case q.Intro:return R;case q.NewSession:return z;case q.ShowSession:return Y;default:throw new Error(`Unknown screen ${_.app.screen}`)}})(_.app.screen);return s.e("div",{className:"app"},s.e(e),s.e(X))},U=({smallBlind:e,bigBlind:t})=>s.e("button",{type:"button",className:"prefill-blinds",onClick:()=>{_.app.newSessionScreen.smallBlind=e.toString(),_.app.newSessionScreen.bigBlind=t.toString(),_.app.newSessionScreen.maxBuyin=(100*t).toString()}},`${e}/${t}`),R=()=>s.e("div",{className:"screen"},s.e("button",{onClick:()=>{window.history.pushState({},"","#/sessions/new"),_.app.screen=q.NewSession}},"Start Session"));class V{static create(t,s,n,i){const r=e();return _.app.sessions[r]={id:e(),casinoName:t,smallBlind:s,bigBlind:n,maxBuyin:i,notes:"",cashoutAmount:0,dealerTips:0,drinkTips:0,buyins:[]},new this(r)}constructor(e){if(this.id=e,!this.attributes)throw new Error(`Session ${e} does not exist`)}get attributes(){return _.app.sessions[this.id]}get startTime(){return this.attributes.startTime?new Date(this.attributes.startTime):null}get endTime(){return this.attributes.endTime?new Date(this.attributes.endTime):null}start(){if(this.startTime)throw new Error("Session already started");if(this.endTime)throw new Error("Session already ended");this.attributes.startTime=t(new Date),this.attributes.buyins.push({amount:this.attributes.maxBuyin,time:this.attributes.startTime})}rebuy(e){this.attributes.buyins.push({amount:e,time:(new Date).toISOString()})}rebuyMax(){this.rebuy(this.attributes.maxBuyin)}end(e,s){this.attributes.cashoutAmount=e,this.attributes.endTime=t(new Date),this.attributes.notes=s}undoEnd(){this.attributes.cashoutAmount=0,delete this.attributes.endTime}buyinsTotal(){return this.attributes.buyins.reduce(((e,t)=>e+t.amount),0)}updateTip(e,t){this.attributes[e]+t<0||(this.attributes[e]+=t)}updateDealerTip(e){this.updateTip("dealerTips",e)}updateDrinkTip(e){this.updateTip("drinkTips",e)}}const J=new class{constructor(e){this.appState=e}get currentSession(){return this.appState.currentSessionId&&this._cachedCurrentSessionId!==this.appState.currentSessionId&&(this._cachedCurrentSessionId=this.appState.currentSessionId,this._cachedCurrentSession=new V(this.appState.currentSessionId)),this._cachedCurrentSession}get mostFrequentCasinoName(){if(this._cachedMostFrequentCasinoName)return this._cachedMostFrequentCasinoName;const e=Object.values(this.appState.sessions).sort(((e,t)=>e.endTime&&t.endTime?Date.parse(t.endTime)-Date.parse(e.endTime):1))[0]?.casinoName;return e&&(this._cachedMostFrequentCasinoName=e),e}}(_.app),z=()=>s.e("div",{className:"screen"},s.e(Q,{onSelect:e=>{_.app.newSessionScreen.casinoName=e}}),s.e("form",{id:"new-session-form"},s.e("div",null,s.e("label",null,s.e("span",null,"Casino Name"),s.e("input",{type:"text",placeholder:J.mostFrequentCasinoName??"Bellagio",required:!0,value:_.app.newSessionScreen.casinoName,onInput:e=>_.app.newSessionScreen.casinoName=e.target.value}))),s.e("div",null,s.e("label",null,s.e("span",null,"Blinds"),s.e(H,{placeholder:"2",value:_.app.newSessionScreen.smallBlind,max:100,onInput:e=>_.app.newSessionScreen.smallBlind=e.target.value}),s.e(H,{placeholder:"5",value:_.app.newSessionScreen.bigBlind,max:200,onInput:e=>_.app.newSessionScreen.bigBlind=e.target.value})),s.e(U,{smallBlind:1,bigBlind:2}),s.e(U,{smallBlind:1,bigBlind:3}),s.e(U,{smallBlind:2,bigBlind:5}),s.e(U,{smallBlind:5,bigBlind:10})),s.e("div",null,s.e("label",null,s.e("span",null,"Max Buyin"),s.e(H,{placeholder:"500",value:_.app.newSessionScreen.maxBuyin,onInput:e=>_.app.newSessionScreen.maxBuyin=e.target.value}))),s.e("div",null,s.e("input",{type:"submit",value:"Start Session"})))),H=({id:e,placeholder:t,value:n,min:i=1,max:r,onInput:a})=>s.e("input",{id:e,type:"number",placeholder:t,pattern:"\\d*",value:n,min:i,max:r,required:!0,onInput:a});class K{constructor(e){this.session=e}drinkTips(){return`$${this.session.attributes.drinkTips??0}`}dealerTips(){return`$${this.session.attributes.dealerTips??0}`}blinds(){return`${this.session.attributes.smallBlind}/${this.session.attributes.bigBlind}`}maxBuyin(){return`$${this.session.attributes.maxBuyin} max`}title(){return[this.session.attributes.casinoName,this.blinds(),this.maxBuyin()].join(" ")}startTime(){return this.session.startTime?.toLocaleString()??""}profit(){return((this.session.attributes.cashoutAmount??0)-this.session.buyinsTotal()).toString()}}const Y=()=>{if(!J.currentSession)return null;const e=new K(J.currentSession);return s.e("div",{className:"screen"},s.e("h1",{className:"session-title"},e.title()),s.e("div",null,s.e("span",null,`Profit: $${e.profit()}`)),s.e("div",null,s.e("span",null,`Start time: ${e.startTime()}`)),J.currentSession.startTime&&s.e("div",null,s.e("span",null,"Time elapsed: ",s.e(W,{startTime:J.currentSession.startTime}))),s.e("form",{id:"rebuy-form",className:"section"},s.e(H,{placeholder:J.currentSession.attributes.maxBuyin.toString(),value:_.app.showSessionScreen.rebuyAmount,onInput:e=>_.app.showSessionScreen.rebuyAmount=e.target.value}),s.e("input",{type:"submit",value:"Rebuy"}),s.e("input",{onClick:()=>J.currentSession?.rebuyMax(),type:"button",value:"Max"})),s.e(G,{type:"dealer",value:e.dealerTips(),onUpdateTip:e=>J.currentSession?.updateDealerTip(e)}),s.e(G,{type:"drink",value:e.drinkTips(),onUpdateTip:e=>J.currentSession?.updateDrinkTip(e)}),s.e("form",{id:"end-session-form",className:"section"},s.e("input",{className:"hidden",type:"text",autocomplete:"username"}),s.e("label",{className:"section"},s.e("div",null,"Notes"),s.e("textarea",{onInput:e=>{e.target&&(_.app.showSessionScreen.notes=e.target.value)}})),s.e("label",{className:"section"},s.e("div",null,"Cashout Amount"),s.e(H,{min:0,value:_.app.showSessionScreen.cashoutAmount,placeholder:(3*J.currentSession.attributes.maxBuyin).toString(),onInput:e=>{e.target&&(_.app.showSessionScreen.cashoutAmount=e.target.value)}})),_.app.cachedAdminPassword?"":s.e("div",null,s.e("label",null,s.e("span",null,"Password")),s.e("input",{type:"password",autocomplete:"current-password",required:!0,onInput:e=>_.app.showSessionScreen.adminPassword=e.target.value})),s.e("input",{type:"submit",value:"End Session",disabled:_.app.showSessionScreen.isSavingSession})))},G=({type:e,value:t,onUpdateTip:n})=>{return s.e("div",{className:"section"},s.e("span",null,`${i=e,`${i[0].toUpperCase()}${i.slice(1)}`} tips: ${t}`),s.e("div",null,s.e("button",{className:"tip-button",onClick:()=>n(-1)},"-"),s.e("button",{className:"tip-button",onClick:()=>n(1)},"+")));var i},Q=({onSelect:e})=>{const t=J.mostFrequentCasinoName;return t?s.e("div",null,`Play at ${t} again?`,s.e("button",{onClick:()=>e(t)},"OK")):null},W=({startTime:e})=>{const[t,n]=s.useState("");return s.useEffect((()=>{const t=()=>{n((e=>{let t=e/1e3;const s=Math.floor(t/3600),n=Math.floor((t-3600*s)/60);return t=Math.round(t-3600*s-60*n),`${s<10?`0${s}`:s.toString()}:${n<10?`0${n}`:n.toString()}:${t<10?`0${t}`:t.toString()}`})(Date.now()-e.getTime()))};setInterval(t,1e3),t()}),[]),s.e("span",null,t.toString())},X=()=>{const[e,t]=s.useState(!1);return s.useEffect((()=>{setTimeout((()=>{t(!0)}),3e3)}),[]),s.e("div",{className:"app-footer "+(e?"app-footer--invisible":"")},"Powered by ",s.e("a",{href:"https://github.com/mhluska/tortie",target:"_blank",rel:"noopener noreferrer"},"tortie"))},Z="localhost"===window.location.hostname?M.Development:M.Production;const ee=()=>{const e=V.create(_.app.newSessionScreen.casinoName,parseInt(_.app.newSessionScreen.smallBlind),parseInt(_.app.newSessionScreen.bigBlind),parseInt(_.app.newSessionScreen.maxBuyin));e.start(),(e=>{window.history.pushState({},"",`#/sessions/${e.id}`),_.app.currentSessionId=e.id,_.app.screen=q.ShowSession})(e)},te=async()=>{if(!J.currentSession)return;let e;J.currentSession.end(parseFloat(_.app.showSessionScreen.cashoutAmount),_.app.showSessionScreen.notes),_.app.showSessionScreen.isSavingSession=!0;try{e=await ne.saveSession(J.currentSession,_.app.cachedAdminPassword??_.app.showSessionScreen.adminPassword)}finally{_.app.showSessionScreen.isSavingSession=!1}e.ok?(_.app.cachedAdminPassword||(_.app.cachedAdminPassword=_.app.showSessionScreen.adminPassword),alert("Success!"),window.history.pushState({},"","#"),_.app.screen=q.Intro):(alert("Something went wrong."),J.currentSession.undoEnd())},se=e=>{if(e.target.tagName)switch(e.preventDefault(),e.target.id){case"new-session-form":ee();break;case"rebuy-form":J.currentSession&&(J.currentSession.rebuy(parseFloat(_.app.showSessionScreen.rebuyAmount)),_.app.showSessionScreen.rebuyAmount="");break;case"end-session-form":te()}},ne=new class{origin(){return Z===M.Development?"http://localhost:3000":"https://blackjack-trainer-api.herokuapp.com"}request(e,t,s){const n=`${this.origin()}/api/v1${e}`;return window.fetch(n,{method:s.method,headers:{...s.headers,"Content-Type":"application/json"},body:JSON.stringify(t)})}post(e,t,s){return this.request(e,t,{method:"POST",...s})}saveSession(e,t){return this.post("/poker_sessions",{data:{type:"poker_session",attributes:e.attributes}},{headers:{"Poker-Sessions-Admin-Password":t}})}},ie=document.getElementById("root");ie&&(F((()=>s.render(s.e(L),ie))),ie.addEventListener("submit",se)),setInterval(j,1e4),document.addEventListener("visibilitychange",j),window.onbeforeunload=j;
//# sourceMappingURL=index.d0876833.js.map
