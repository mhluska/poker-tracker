var e={};function t(e,t,n,s){Object.defineProperty(e,t,{get:n,set:s,enumerable:!0,configurable:!0})}let n;var s;t(e,"render",(()=>P)),t(e,"createElement",(()=>T)),t(e,"e",(()=>k)),t(e,"useEffect",(()=>S)),t(e,"useState",(()=>h)),(s=n||(n={}))[s.Element=1]="Element",s[s.Text=3]="Text";const i=Object.keys,r=e=>"function"==typeof e.type,a=e=>!(e=>"String"===e.type)(e)&&!r(e),o=e=>e.nodeType===n.Text,u=(e,t)=>{if(t)return e.parentElement?.replaceChild(t,e)},l=(e,t)=>{if(t)return e.appendChild(t)},p=(e,t,n)=>{if(e&&t)return e.insertBefore(t,n)};let c,d;const m={useStateCallCount:0,useState:new Map,useEffect:new Map},S=(e,t)=>{const n=m.useEffect.get(c)||[];n.push({callback:e,dependencies:t,unmountCallback:void 0}),m.useEffect.set(c,n)},h=e=>{let t=m.useState.get(c);t||(t=[],m.useState.set(c,t));let n=t[m.useStateCallCount];n||(n={value:e},t.push(n)),m.useStateCallCount+=1;return[n.value,(s=n,e=>{s.value!==e&&(s.value=e,requestIdleCallback(d))})];var s},b=(e,t)=>{m.useStateCallCount=0,c=e.type,d=t;const n=m.useEffect.get(e.type);m.useEffect.delete(e.type),e.result=e.type(e.props);const s=m.useEffect.get(c);return s&&0!==s.length?(s.forEach(((e,t)=>{const s=n?.[t];s&&((e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0})(s.dependencies,e.dependencies)?e.unmountCallback=s.unmountCallback:e.unmountCallback=e.callback()})),e.result):e.result},w=e=>{(e=>{void 0===e.requestIdleCallback&&(e.requestIdleCallback=(e,t)=>setTimeout(e,0))})(e)};let f;var g;(g=f||(f={})).Value="value",g.ClassName="className";const v=new Set(Object.values(f)),y=new Map([["onInput","input"],["onClick","click"],["onSubmit","submit"]]);function T(e,t,...n){return"function"==typeof e?{type:e,props:t||{},result:null}:{type:e,props:{...t,tagName:e||"div"},children:n.map((e=>"string"==typeof e?{type:"String",value:e}:e))}}const k=T,B=(e,t,n,s)=>{n!==s&&(n&&e.removeEventListener(t,n),s&&e.addEventListener(t,s))},N=(e,t,n)=>{if("String"===t?.type||"String"===n?.type)return;const s=t?i(t.props):[],r=n?i(n.props):[];for(const i of r.concat(s)){const s=t?.props[i],r=n?.props[i];if(v.has(i))e[i]=void 0===r?"":r;else if(s!==r)if("onClick"!==i&&"onInput"!==i&&"onSubmit"!==i)"boolean"==typeof r?r?e.setAttribute(i,""):e.removeAttribute(i):void 0===r?e.removeAttribute(i):e.setAttribute(i,String(r));else{const s=y.get(i);s&&B(e,s,t?.props[i],n?.props[i])}}},C=e=>{if(!e)return null;if("String"===e.type)return $.createTextNode(e.value);if(r(e))return C(b(e,E));const{children:t,type:n}=e,s=$.createElement(n);N(s,null,e);for(const e of t){if(!e)continue;const t=C(e);t&&s.appendChild(t)}return s},I=(e,t,s)=>{t.value!==s.value&&(e.nodeType===n.Element?u(e,C(s)):o(e)&&e.replaceData(0,e.length,s.value))},x=(e,t,s)=>{if(s){if(!t||t.type!==s.type)return t&&r(t)&&(e=>{const t=m.useEffect.get(e.type);if(!t)return e.result;for(const{unmountCallback:e}of t)e&&e();m.useEffect.delete(e.type),m.useState.delete(e.type),e.result})(t),void u(e,C(s));if("String"!==t.type||"String"!==s.type){if(o(e))u(e,C(s));else if(r(t)&&r(s))x(e,t.result,b(s,E));else if(a(t)&&a(s)){N(e,t,s);const i=Array.from(e.childNodes).filter((e=>e.nodeType===n.Element||e.nodeType===n.Text)),a=Math.max(t.children.length,s.children.length);let o=0;for(let n=0;n<a;n+=1){const a=i[o],u=t.children[n],c=s.children[n],d=u&&r(u)?!!u.result:!!u,m=!!c;if(a)if(d&&m)x(a,u,c);else{if(!d){if(m){p(e,C(c),a);continue}continue}a.remove()}else m&&l(e,C(c));o+=1}}}else I(e,t,s)}else e.remove()};let E,$,A=T("div"),D=!1;const P=(e,t)=>{$=t.ownerDocument,!D&&$.defaultView&&(w($.defaultView),D=!0);const n=T("div",null,e);E=()=>P(e,t),x(t,A,n),A=n};let M,q;!function(e){e.Development="development",e.Production="production"}(M||(M={})),function(e){e.Intro="intro",e.NewSession="new-session",e.ShowSession="show-session"}(q||(q={}));const O=e=>e?"new"===e?q.NewSession:q.ShowSession:q.Intro,j={app:(()=>{const e=window.localStorage.getItem("pokerTracker"),t=e?JSON.parse(e):{},n=(()=>{const e=window.location.hash.match(/#\/sessions\/(.+)/);if(e)return e[1]})();return{screen:O(n),sessions:{},currentSessionId:n,showSessionScreen:{rebuyAmount:"",notes:"",cashoutAmount:"",adminPassword:"",isSavingSession:!1},newSessionScreen:{casinoName:"",smallBlind:"",bigBlind:"",maxBuyin:""},...t}})()},F=()=>{window.localStorage.setItem("pokerTracker",JSON.stringify({sessions:j.app.sessions,cachedAdminPassword:j.app.cachedAdminPassword}))},U=()=>{const t=(e=>{switch(e){case q.Intro:return H;case q.NewSession:return K;case q.ShowSession:return W;default:throw new Error(`Unknown screen ${j.app.screen}`)}})(j.app.screen);return e.e("div",{className:"app"},e.e(t),e.e(te))},L=({smallBlind:t,bigBlind:n})=>e.e("button",{type:"button",className:"prefill-blinds",onClick:()=>{j.app.newSessionScreen.smallBlind=t.toString(),j.app.newSessionScreen.bigBlind=n.toString(),j.app.newSessionScreen.maxBuyin=(100*n).toString()}},`${t}/${n}`),R=e=>{const t=-e.getTimezoneOffset(),n=t>=0?"+":"-",s=e=>(e<10?"0":"")+e;return e.getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+"T"+s(e.getHours())+":"+s(e.getMinutes())+":"+s(e.getSeconds())+n+s(Math.floor(Math.abs(t)/60))+":"+s(Math.abs(t)%60)};class J{static create(e,t,n,s){const i=Date.now().toString(36)+Math.random().toString(36).substring(2);return j.app.sessions[i]={id:i,casinoName:e,smallBlind:t,bigBlind:n,maxBuyin:s,notes:"",cashoutAmount:0,dealerTips:0,drinkTips:0,buyins:[]},new this(i)}constructor(e){if(this.id=e,!this.attributes)throw new Error(`Session ${e} does not exist`)}get attributes(){return j.app.sessions[this.id]}get startTime(){return this.attributes.startTime?new Date(this.attributes.startTime):null}get endTime(){return this.attributes.endTime?new Date(this.attributes.endTime):null}start(){if(this.startTime)throw new Error("Session already started");if(this.endTime)throw new Error("Session already ended");this.attributes.startTime=R(new Date),this.attributes.buyins.push({amount:this.attributes.maxBuyin,time:this.attributes.startTime})}rebuy(e){this.attributes.buyins.push({amount:e,time:(new Date).toISOString()})}rebuyMax(){this.rebuy(this.attributes.maxBuyin)}end(e,t){this.attributes.cashoutAmount=e,this.attributes.endTime=R(new Date),this.attributes.notes=t}undoEnd(){this.attributes.cashoutAmount=0,delete this.attributes.endTime}buyinsTotal(){return this.attributes.buyins.reduce(((e,t)=>e+t.amount),0)}updateTip(e,t){this.attributes[e]+t<0||(this.attributes[e]+=t)}updateDealerTip(e){this.updateTip("dealerTips",e)}updateDrinkTip(e){this.updateTip("drinkTips",e)}}class V{constructor(e){this.session=e}drinkTips(){return`$${this.session.attributes.drinkTips??0}`}dealerTips(){return`$${this.session.attributes.dealerTips??0}`}blinds(){return`${this.session.attributes.smallBlind}/${this.session.attributes.bigBlind}`}maxBuyin(){return`$${this.session.attributes.maxBuyin} max`}title(){return[this.session.attributes.casinoName,this.blinds(),this.maxBuyin()].join(" ")}startTime(){return this.session.startTime?.toLocaleString()??""}profit(){return((this.session.attributes.cashoutAmount??0)-this.session.buyinsTotal()).toString()}}const _=new class{constructor(e){this.appState=e}get currentSession(){if(this.appState.currentSessionId)return new J(this.appState.currentSessionId)}get recentSessions(){return Object.values(this.appState.sessions).sort(((e,t)=>e.startTime&&t.startTime?Date.parse(t.startTime)-Date.parse(e.startTime):-1)).map((e=>new V(new J(e.id))))}get mostFrequentCasinoName(){return this.recentSessions[0]?.session.attributes.casinoName}}(j.app),z=()=>e.e("div",null,e.e("ol",null,..._.recentSessions.map((t=>e.e("li",null,e.e("a",{href:`/#/sessions/${t.session.attributes.id}`,onClick:()=>{return e=t.session.attributes.id,j.app.currentSessionId=e,void(j.app.screen=q.ShowSession);var e}},t.title()),e.e("span",null,` ${t.startTime()}`))))),_.recentSessions.length>0?e.e("a",{href:"#",onClick:e=>{e.preventDefault(),j.app.currentSessionId="",j.app.sessions={}}},"Clear sessions"):null),H=()=>e.e("div",{className:"screen"},e.e("button",{onClick:()=>{window.history.pushState({},"","#/sessions/new"),j.app.screen=q.NewSession}},"New Session"),e.e(z)),K=()=>e.e("div",{className:"screen"},e.e(Z,{onSelect:e=>{j.app.newSessionScreen.casinoName=e}}),e.e("form",{onSubmit:e=>{e.preventDefault();const t=J.create(j.app.newSessionScreen.casinoName,parseInt(j.app.newSessionScreen.smallBlind),parseInt(j.app.newSessionScreen.bigBlind),parseInt(j.app.newSessionScreen.maxBuyin));t.start(),(e=>{window.history.pushState({},"",`#/sessions/${e.id}`),j.app.currentSessionId=e.id,j.app.screen=q.ShowSession})(t)}},e.e("div",null,e.e("label",null,e.e("span",null,"Casino Name"),e.e("input",{type:"text",placeholder:_.mostFrequentCasinoName??"Bellagio",required:!0,value:j.app.newSessionScreen.casinoName,onInput:e=>j.app.newSessionScreen.casinoName=e.target.value}))),e.e("div",null,e.e("label",null,e.e("span",null,"Blinds"),e.e(Y,{placeholder:"2",value:j.app.newSessionScreen.smallBlind,max:100,onInput:e=>j.app.newSessionScreen.smallBlind=e.target.value}),e.e(Y,{placeholder:"5",value:j.app.newSessionScreen.bigBlind,max:200,onInput:e=>j.app.newSessionScreen.bigBlind=e.target.value})),e.e(L,{smallBlind:1,bigBlind:2}),e.e(L,{smallBlind:1,bigBlind:3}),e.e(L,{smallBlind:2,bigBlind:5}),e.e(L,{smallBlind:5,bigBlind:10})),e.e("div",null,e.e("label",null,e.e("span",null,"Max Buyin"),e.e(Y,{placeholder:"500",value:j.app.newSessionScreen.maxBuyin,onInput:e=>j.app.newSessionScreen.maxBuyin=e.target.value}))),e.e("div",null,e.e("input",{type:"submit",value:"Start Session"})))),Y=({id:t,placeholder:n,value:s,min:i=1,max:r,onInput:a})=>e.e("input",{id:t,type:"number",placeholder:n,pattern:"\\d*",value:s,min:i,max:r,required:!0,onInput:a}),G="localhost"===window.location.hostname?M.Development:M.Production;const Q=new class{origin(){return G===M.Development?"http://localhost:3000":"https://blackjack-trainer-api.herokuapp.com"}request(e,t,n){const s=`${this.origin()}/api/v1${e}`;return window.fetch(s,{method:n.method,headers:{...n.headers,"Content-Type":"application/json"},body:JSON.stringify(t)})}post(e,t,n){return this.request(e,t,{method:"POST",...n})}saveSession(e,t){return this.post("/poker_sessions",{data:{type:"poker_session",attributes:e.attributes}},{headers:{"Poker-Sessions-Admin-Password":t}})}},W=()=>{if(!_.currentSession)return null;const t=new V(_.currentSession),n=async()=>{if(!_.currentSession)return;let e;_.currentSession.end(parseFloat(j.app.showSessionScreen.cashoutAmount),j.app.showSessionScreen.notes),j.app.showSessionScreen.isSavingSession=!0;try{e=await Q.saveSession(_.currentSession,j.app.cachedAdminPassword??j.app.showSessionScreen.adminPassword)}finally{j.app.showSessionScreen.isSavingSession=!1}e.ok?(j.app.cachedAdminPassword||(j.app.cachedAdminPassword=j.app.showSessionScreen.adminPassword),alert("Success!"),window.history.pushState({},"","#"),j.app.screen=q.Intro):(alert("Something went wrong."),_.currentSession.undoEnd())};return e.e("div",{className:"screen"},e.e("h1",{className:"session-title"},t.title()),e.e("div",null,e.e("span",null,`Profit: $${t.profit()}`)),e.e("div",null,e.e("span",null,`Start time: ${t.startTime()}`)),_.currentSession.startTime&&e.e("div",null,e.e("span",null,"Time elapsed: ",e.e(ee,{startTime:_.currentSession.startTime}))),e.e("form",{className:"section",onSubmit:e=>{e.preventDefault(),_.currentSession&&(_.currentSession.rebuy(parseFloat(j.app.showSessionScreen.rebuyAmount)),j.app.showSessionScreen.rebuyAmount="")}},e.e(Y,{placeholder:_.currentSession.attributes.maxBuyin.toString(),value:j.app.showSessionScreen.rebuyAmount,onInput:e=>j.app.showSessionScreen.rebuyAmount=e.target.value}),e.e("input",{type:"submit",value:"Rebuy"}),e.e("input",{onClick:()=>_.currentSession?.rebuyMax(),type:"button",value:"Max"})),e.e(X,{type:"dealer",value:t.dealerTips(),onUpdateTip:e=>_.currentSession?.updateDealerTip(e)}),e.e(X,{type:"drink",value:t.drinkTips(),onUpdateTip:e=>_.currentSession?.updateDrinkTip(e)}),e.e("form",{className:"section",onSubmit:e=>{e.preventDefault(),n()}},e.e("input",{className:"hidden",type:"text",autocomplete:"username"}),e.e("label",{className:"section"},e.e("div",null,"Notes"),e.e("textarea",{onInput:e=>{e.target&&(j.app.showSessionScreen.notes=e.target.value)}})),e.e("label",{className:"section"},e.e("div",null,"Cashout Amount"),e.e(Y,{min:0,value:j.app.showSessionScreen.cashoutAmount,placeholder:(3*_.currentSession.attributes.maxBuyin).toString(),onInput:e=>{e.target&&(j.app.showSessionScreen.cashoutAmount=e.target.value)}})),j.app.cachedAdminPassword?"":e.e("div",null,e.e("label",null,e.e("span",null,"Password")),e.e("input",{type:"password",autocomplete:"current-password",required:!0,onInput:e=>j.app.showSessionScreen.adminPassword=e.target.value})),e.e("input",{type:"submit",value:"End Session",disabled:j.app.showSessionScreen.isSavingSession})))},X=({type:t,value:n,onUpdateTip:s})=>{return e.e("div",{className:"section"},e.e("span",null,`${i=t,`${i[0].toUpperCase()}${i.slice(1)}`} tips: ${n}`),e.e("div",null,e.e("button",{className:"tip-button",onClick:()=>s(-1)},"-"),e.e("button",{className:"tip-button",onClick:()=>s(1)},"+")));var i},Z=({onSelect:t})=>{const n=_.mostFrequentCasinoName;return n?e.e("div",null,`Play at ${n} again?`,e.e("button",{onClick:()=>t(n)},"OK")):null},ee=({startTime:t})=>{const[n,s]=e.useState("");return e.useEffect((()=>{const e=()=>{s((e=>{let t=e/1e3;const n=Math.floor(t/3600),s=Math.floor((t-3600*n)/60);return t=Math.round(t-3600*n-60*s),`${n<10?`0${n}`:n.toString()}:${s<10?`0${s}`:s.toString()}:${t<10?`0${t}`:t.toString()}`})(Date.now()-t.getTime()))};setInterval(e,1e3),e()}),[]),e.e("span",null,n.toString())},te=()=>{const[t,n]=e.useState(!1);return e.useEffect((()=>{setTimeout((()=>{n(!0)}),3e3)}),[]),e.e("div",{className:"app-footer "+(t?"app-footer--invisible":"")},"Powered by ",e.e("a",{href:"https://github.com/mhluska/recat",target:"_blank",rel:"noopener noreferrer"},"recat"))},ne=document.getElementById("root");if(!ne)throw new Error("Missing root element with ID root");var se;se=()=>e.render(e.e(U),ne),j.app=new Proxy(j.app,{get(e,t,n){if(!Reflect.has(e,t))return;const s=Reflect.get(e,t,n);return"object"==typeof s&&null!==s?new Proxy(s,this):s},set(e,t,n,s){const i=Reflect.set(e,t,n,s);return i&&se(),i}}),se(),setInterval(F,1e4),document.addEventListener("visibilitychange",F),window.onbeforeunload=F;
//# sourceMappingURL=index.5c96d186.js.map
