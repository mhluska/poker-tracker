const e=Object.keys,t=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),s=e=>!!e.tagName,n=e=>"object"==typeof e&&!Array.isArray(e);let i,r;!function(e){e.Development="development",e.Production="production"}(i||(i={})),function(e){e.Intro="intro",e.NewSession="new-session",e.ShowSession="show-session"}(r||(r={}));const a=e=>e?"new"===e?r.NewSession:r.ShowSession:r.Intro,o=(()=>{const e=window.localStorage.getItem("pokerTracker"),t=e?JSON.parse(e):{},s=(()=>{const e=window.location.hash.match(/#\/sessions\/(.+)/);if(e)return e[1]})();return{screen:a(s),sessions:{},currentSessionId:s,showSessionScreen:{rebuyAmount:"",cashoutAmount:"",adminPassword:"",isSavingSession:!1},newSessionScreen:{casinoName:"",smallBlind:"",bigBlind:"",maxBuyin:"",maxPlayers:"8"},...t}})(),u=()=>{window.localStorage.setItem("pokerTracker",JSON.stringify({sessions:o.sessions,cachedAdminPassword:o.cachedAdminPassword}))},l=()=>{switch(o.screen){case r.Intro:return g();case r.NewSession:return f();case r.ShowSession:return N();default:return""}},d=new Set(["value","className"]),c=e=>{return!((t=e)[0].toUpperCase()===t[0]);var t},p=e=>"string"==typeof e?"string":e.type,m=(e,t=null,...s)=>({type:e,tagName:c(e)?e:t?.tagName,props:t||{},children:s}),S=t=>{if("string"==typeof t)return document.createTextNode(t);const{tagName:s,props:n,children:i}=t,r=document.createElement(s);if(n)for(const t of e(n)){if("tagName"===t)continue;const e=n[t];d.has(t)?r[t]=e:"boolean"==typeof e?e&&r.setAttribute(t,""):r.setAttribute(t,String(e))}for(const e of i){const t=S(e);t&&r.appendChild(t)}return r},h=(t,s,n,i)=>{if(t)if(s&&n){if(p(s)!==p(n))return void t.parentElement?.replaceChild(S(n),t);if("string"==typeof s)return void t.parentElement?.replaceChild(S(n),t);if("string"==typeof n)return;((t,s,n)=>{for(const i of e(n.props))d.has(i)&&void 0!==n.props[i]?t[i]=n.props[i]:n.props[i]!==s.props[i]&&("boolean"==typeof n.props[i]?n.props[i]?t.setAttribute(i,""):t.removeAttribute(i):t.setAttribute(i,String(n.props[i])));for(const i of e(s.props))void 0===n.props[i]&&(d.has(i)?t[i]="":t.removeAttribute(i))})(t,s,n),n.children.forEach(((e,n)=>{h(Array.from(t.childNodes).filter((e=>1===e.nodeType||3===e.nodeType))[n],s.children[n],e,t)}))}else n?t.parentElement?.replaceChild(S(n),t):s&&t.remove();else i.appendChild(S(n))};let b=m("div");const w=(e,t)=>{if(!t)throw new Error("appRoot is not set");if(!t.parentElement)throw new Error("appRoot not attached to DOM");const s=m("div",null,e);h(t,b,s,t.parentElement),b=s},y=({smallBlind:e,bigBlind:t})=>m("BlindsButton",{tagName:"button",type:"button",className:"prefill-blinds","data-small-blind":e,"data-big-blind":t},`${e}/${t}`),g=()=>m("IntroScreen",{tagName:"div",id:"intro-screen",className:"screen"},m("button",{id:"new-session-button"},"Start Session")),f=()=>m("NewSessionScreen",{tagName:"div",id:"new-session-screen",className:"screen"},m("form",{id:"new-session-form"},m("div",null,m("label",null,m("span",null,"Casino Name"),m("input",{id:"casino-name-input",type:"text",placeholder:"Bellagio",required:!0,value:o.newSessionScreen.casinoName}))),m("div",null,m("label",null,m("span",null,"Blinds"),v({id:"small-blind-input",placeholder:"2",value:o.newSessionScreen.smallBlind,max:100}),v({id:"big-blind-input",placeholder:"5",value:o.newSessionScreen.bigBlind,max:200})),y({smallBlind:1,bigBlind:2}),y({smallBlind:1,bigBlind:3}),y({smallBlind:2,bigBlind:5}),y({smallBlind:5,bigBlind:10})),m("div",null,m("label",null,m("span",null,"Max Buyin"),v({id:"max-buyin-input",placeholder:"500",value:o.newSessionScreen.maxBuyin}))),m("div",null,m("label",null,m("span",null,"Max Players"),v({id:"max-players-input",placeholder:"8",max:10,value:o.newSessionScreen.maxPlayers}))),m("div",null,m("input",{type:"submit",value:"Start Session"})))),v=({id:e,placeholder:t,value:s,min:n=1,max:i})=>m("NumberInput",{tagName:"input",id:e,type:"number",placeholder:t,pattern:"\\d*",value:s,min:n,max:i,required:!0});class B{constructor(e){this.session=e}drinkTips(){return`$${this.session.attributes.drinkTips??0}`}dealerTips(){return`$${this.session.attributes.dealerTips??0}`}blinds(){return`${this.session.attributes.smallBlind}/${this.session.attributes.bigBlind}`}maxBuyin(){return`$${this.session.attributes.maxBuyin} max`}title(){return[this.session.attributes.casinoName,this.blinds(),this.maxBuyin()].join(" ")}startTime(){return this.session.startTime?.toLocaleString()??""}profit(){return((this.session.attributes.cashoutAmount??0)-this.session.buyinsTotal()).toString()}timeElapsed(){return this.session.startTime?(e=>{let t=e/1e3;const s=Math.floor(t/3600),n=Math.floor((t-3600*s)/60);return t=Math.round(t-3600*s-60*n),`${s<10?`0${s}`:s.toString()}:${n<10?`0${n}`:n.toString()}:${t<10?`0${t}`:t.toString()}`})(Date.now()-this.session.startTime.getTime()):""}}class T{static create(e,s,n,i,r){const a=t();return o.sessions[a]={id:t(),casinoName:e,smallBlind:s,bigBlind:n,maxBuyin:i,maxPlayers:r,cashoutAmount:0,dealerTips:0,drinkTips:0,buyins:[]},new this(a)}constructor(e){if(this.id=e,!this.attributes)throw new Error(`Session ${e} does not exist`)}get attributes(){return o.sessions[this.id]}get startTime(){return this.attributes.startTime?new Date(this.attributes.startTime):null}get endTime(){return this.attributes.endTime?new Date(this.attributes.endTime):null}start(){if(this.startTime)throw new Error("Session already started");if(this.endTime)throw new Error("Session already ended");this.attributes.startTime=(new Date).toISOString(),this.attributes.buyins.push({amount:this.attributes.maxBuyin,time:this.attributes.startTime})}rebuy(e){this.attributes.buyins.push({amount:e,time:(new Date).toISOString()})}rebuyMax(){this.rebuy(this.attributes.maxBuyin)}end(e){this.attributes.cashoutAmount=e,this.attributes.endTime=(new Date).toISOString()}undoEnd(){this.attributes.cashoutAmount=0,delete this.attributes.endTime}buyinsTotal(){return this.attributes.buyins.reduce(((e,t)=>e+t.amount),0)}updateTip(e,t){this.attributes[e]+t<0||(this.attributes[e]+=t)}updateDealerTip(e){this.updateTip("dealerTips",e)}updateDrinkTip(e){this.updateTip("drinkTips",e)}}const x=new class{constructor(e){this.appState=e}get currentSession(){return this.appState.currentSessionId&&this._cachedCurrentSessionId!==this.appState.currentSessionId&&(this._cachedCurrentSessionId=this.appState.currentSessionId,this._cachedCurrentSession=new T(this.appState.currentSessionId)),this._cachedCurrentSession}}(o),N=()=>{if(!x.currentSession)return"";const e=new B(x.currentSession);return m("ShowSessionScreen",{tagName:"div",id:"show-session-screen",className:"screen"},m("h1",{id:"session-title"},e.title()),m("div",null,m("span",null,`Profit: $${e.profit()}`)),m("div",null,m("span",null,`Start time: $${e.startTime()}`)),m("div",null,m("span",null,`Time elapsed: ${e.timeElapsed()}`)),m("form",{id:"rebuy-form",className:"section"},v({id:"rebuy-amount-input",placeholder:x.currentSession.attributes.maxBuyin.toString(),max:x.currentSession.attributes.maxBuyin,value:o.showSessionScreen.rebuyAmount}),m("input",{type:"submit",value:"Rebuy"}),m("input",{id:"rebuy-max-button",type:"button",value:"Max"})),$({type:"dealer",value:e.dealerTips()}),$({type:"drink",value:e.drinkTips()}),m("form",{id:"end-session-form",className:"section"},m("input",{className:"hidden",type:"text",autocomplete:"username"}),m("div",null,m("label",null,m("span",null,"Cashout Amount"),v({min:0,id:"cashout-amount-input",placeholder:(3*x.currentSession.attributes.maxBuyin).toString()}))),o.cachedAdminPassword?"":m("div",{id:"admin-password-area"},m("label",null,m("span",null,"Password")),m("input",{id:"admin-password-input",type:"password",autocomplete:"current-password",required:!0})),m("input",{id:"end-session-submit-button",type:"submit",value:"End Session",disabled:o.showSessionScreen.isSavingSession})))},$=({type:e,value:t})=>{return m("TipsSection",{tagName:"div",className:"section"},m("span",null,`${s=e,`${s[0].toUpperCase()}${s.slice(1)}`} tips: ${t}`),m("div",null,m("button",{className:"tip-button",id:`decrement-${e}-tip-button`},"-"),m("button",{className:"tip-button",id:`increment-${e}-tip-button`},"+")));var s},A="localhost"===window.location.hostname?i.Development:i.Production;const I=()=>{const e=T.create(o.newSessionScreen.casinoName,parseInt(o.newSessionScreen.smallBlind),parseInt(o.newSessionScreen.bigBlind),parseInt(o.newSessionScreen.maxBuyin),parseInt(o.newSessionScreen.maxPlayers));e.start(),(e=>{window.history.pushState({},"",`#/sessions/${e.id}`),o.currentSessionId=e.id,o.screen=r.ShowSession})(e)},k=async()=>{if(!x.currentSession)return;let e;x.currentSession.end(parseFloat(o.showSessionScreen.cashoutAmount)),o.showSessionScreen.isSavingSession=!0,w(l(),_);try{e=await L.saveSession(x.currentSession,o.cachedAdminPassword??o.showSessionScreen.adminPassword)}finally{o.showSessionScreen.isSavingSession=!1,w(l(),_)}e.ok?(o.cachedAdminPassword||(o.cachedAdminPassword=o.showSessionScreen.adminPassword),alert("Success!"),window.history.pushState({},"","#"),o.screen=r.Intro):(alert("Something went wrong."),x.currentSession.undoEnd())},P=e=>{if(!s(e.target))return!1;switch(e.target.id){case"new-session-button":return window.history.pushState({},"","#/sessions/new"),o.screen=r.NewSession,!0;case"decrement-dealer-tip-button":return x.currentSession?.updateDealerTip(-1),!0;case"increment-dealer-tip-button":return x.currentSession?.updateDealerTip(1),!0;case"decrement-drink-tip-button":return x.currentSession?.updateDrinkTip(-1),!0;case"increment-drink-tip-button":return x.currentSession?.updateDrinkTip(1),!0;case"rebuy-max-button":return x.currentSession?.rebuyMax(),!0}return!!(e.target.classList.contains("prefill-blinds")&&e.target.dataset.smallBlind&&e.target.dataset.bigBlind)&&(n=e.target.dataset.smallBlind,i=e.target.dataset.bigBlind,o.newSessionScreen.smallBlind=n,o.newSessionScreen.bigBlind=i,t=(100*parseInt(e.target.dataset.bigBlind)).toString(),o.newSessionScreen.maxBuyin=t,!0);var t,n,i},E=e=>{P(e)&&w(l(),_)},D=async e=>{if(!s(e.target))return!1;switch(e.preventDefault(),e.target.id){case"new-session-form":return I(),!0;case"rebuy-form":return x.currentSession&&(x.currentSession.rebuy(parseFloat(o.showSessionScreen.rebuyAmount)),o.showSessionScreen.rebuyAmount=""),!0;case"end-session-form":return await k(),!0}return!1},C=async e=>{await D(e)&&w(l(),_)},M=e=>{if(!e.target.type)return!1;const t=(e=>{switch(e){case"casino-name-input":return"newSessionScreen.casinoName";case"small-blind-input":return"newSessionScreen.smallBlind";case"big-blind-input":return"newSessionScreen.bigBlind";case"max-buyin-input":return"newSessionScreen.maxBuyin";case"max-players-input":return"newSessionScreen.maxPlayers";case"rebuy-amount-input":return"showSessionScreen.rebuyAmount";case"cashout-amount-input":return"showSessionScreen.cashoutAmount";case"admin-password-input":return"showSessionScreen.adminPassword"}})(e.target.id);return!!t&&((e,t,s)=>{if(!t)return;const i=t.split("."),r=i.pop();if(r){for(const t of i){const s=e[t];if(!n(s))return;e=s}e[r]=s}})(o,t,e.target.value)},O=e=>{M(e)&&w(l(),_)},L=new class{origin(){return A===i.Development?"http://localhost:3000":"https://blackjack-trainer-api.herokuapp.com"}request(e,t,s){const n=`${this.origin()}/api/v1${e}`;return window.fetch(n,{method:s.method,headers:{...s.headers,"Content-Type":"application/json"},body:JSON.stringify(t)})}post(e,t,s){return this.request(e,t,{method:"POST",...s})}saveSession(e,t){return this.post("/poker_sessions",{data:{type:"poker_session",attributes:e.attributes}},{headers:{"Poker-Sessions-Admin-Password":t}})}},_=document.getElementById("root");_&&(_.addEventListener("click",E),_.addEventListener("submit",C),_.addEventListener("input",O)),setInterval(u,1e4),document.addEventListener("visibilitychange",u),window.onbeforeunload=u,w(l(),_);
//# sourceMappingURL=index.72d46762.js.map
