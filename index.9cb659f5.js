const e=Object.keys,t=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),n=e=>!!e.tagName,s=e=>"object"==typeof e&&!Array.isArray(e),i=e=>{const t=-e.getTimezoneOffset(),n=t>=0?"+":"-",s=e=>(e<10?"0":"")+e;return e.getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+"T"+s(e.getHours())+":"+s(e.getMinutes())+":"+s(e.getSeconds())+n+s(Math.floor(Math.abs(t)/60))+":"+s(Math.abs(t)%60)};let r,a;!function(e){e.Development="development",e.Production="production"}(r||(r={})),function(e){e.Intro="intro",e.NewSession="new-session",e.ShowSession="show-session"}(a||(a={}));const o=e=>e?"new"===e?a.NewSession:a.ShowSession:a.Intro,u=(()=>{const e=window.localStorage.getItem("pokerTracker"),t=e?JSON.parse(e):{},n=(()=>{const e=window.location.hash.match(/#\/sessions\/(.+)/);if(e)return e[1]})();return{screen:o(n),sessions:{},currentSessionId:n,showSessionScreen:{rebuyAmount:"",notes:"",cashoutAmount:"",adminPassword:"",isSavingSession:!1},newSessionScreen:{casinoName:"",smallBlind:"",bigBlind:"",maxBuyin:""},...t}})(),l=()=>{window.localStorage.setItem("pokerTracker",JSON.stringify({sessions:u.sessions,cachedAdminPassword:u.cachedAdminPassword}))},d=()=>{switch(u.screen){case a.Intro:return E();case a.NewSession:return $();case a.ShowSession:return P();default:throw new Error(`Unknown screen ${u.screen}`)}};let c;var p;(p=c||(c={}))[p.Element=1]="Element",p[p.Text=3]="Text";const m=new Set(["value","className"]),h={onInput:{propName:"onInput",nativeEventName:"input",supportedElements:new Set(["input","select","textarea"])}},S=e=>{return!((t=e)[0].toUpperCase()===t[0]);var t},b=e=>e.nodeType===c.Text,w=(e,t=null,...n)=>({type:e,props:{...t,tagName:t?.tagName||(S(e)?e:"div")},children:n.map((e=>"string"==typeof e?{type:"String",props:{value:e},children:[]}:e))}),g=w,y=t=>{if("String"===t.type)return document.createTextNode(t.props.value);const{props:n,children:s}=t,{tagName:i}=n,r=document.createElement(i);if(n)for(const t of e(n)){if("tagName"===t)continue;const e=n[t];if(h[t]){if(h[t].supportedElements.has(i)){r.addEventListener(h[t].nativeEventName,e);continue}throw new Error(`Added onInput to invalid element type ${i}`)}m.has(t)?r[t]=e:"boolean"==typeof e?e&&r.setAttribute(t,""):r.setAttribute(t,String(e))}for(const e of s){const t=y(e);t&&r.appendChild(t)}return r},v=(e,t,n,s)=>{n&&e.removeEventListener(h[t].nativeEventName,n),s&&e.addEventListener(h[t].nativeEventName,s)},f=(e,t,n)=>{"String"===n.type&&("String"===t.type&&t.props.value===n.props.value||(e.nodeType===c.Element?e.parentElement?.replaceChild(y(n),e):b(e)&&e.replaceData(0,e.length,n.props.value)))},T=(t,n,s,i)=>{if(!t)return void(s&&i.appendChild(y(s)));if(!s)return void t.remove();if(!n||n.type!==s.type)return void i.replaceChild(y(s),t);if("String"===s.type)return void f(t,n,s);if(b(t))return void i.replaceChild(y(s),t);((t,n,s)=>{for(const i of e(s.props).concat(e(n.props))){const e=n.props[i],r=s.props[i];m.has(i)?t[i]=void 0===r?"":r:e!==r&&(h[i]?v(t,h[i].propName,e,r):"boolean"==typeof r?r?t.setAttribute(i,""):t.removeAttribute(i):void 0===r?t.removeAttribute(i):t.setAttribute(i,String(r)))}})(t,n,s);const r=Array.from(t.childNodes).filter((e=>e.nodeType===c.Element||e.nodeType===c.Text));s.children.forEach(((e,s)=>{T(r[s],n.children[s],e,t)}))};let N=w("div");const B=(e,t)=>{if(!e)throw new Error("component is null");if(!t)throw new Error("appRoot is not set");if(!t.parentElement)throw new Error("appRoot not attached to DOM");const n=w("div",null,e);T(t,N,n,t.parentElement),N=n},x=({smallBlind:e,bigBlind:t})=>g("BlindsButton",{tagName:"button",type:"button",className:"prefill-blinds","data-small-blind":e,"data-big-blind":t},`${e}/${t}`),E=()=>g("IntroScreen",{tagName:"div",id:"intro-screen",className:"screen"},g("button",{id:"new-session-button"},"Start Session")),$=()=>g("NewSessionScreen",{tagName:"div",id:"new-session-screen",className:"screen"},g("form",{id:"new-session-form"},g("div",null,g("label",null,g("span",null,"Casino Name"),g("input",{id:"casino-name-input",type:"text",placeholder:"Bellagio",required:!0,value:u.newSessionScreen.casinoName}))),g("div",null,g("label",null,g("span",null,"Blinds"),A({id:"small-blind-input",placeholder:"2",value:u.newSessionScreen.smallBlind,max:100}),A({id:"big-blind-input",placeholder:"5",value:u.newSessionScreen.bigBlind,max:200})),x({smallBlind:1,bigBlind:2}),x({smallBlind:1,bigBlind:3}),x({smallBlind:2,bigBlind:5}),x({smallBlind:5,bigBlind:10})),g("div",null,g("label",null,g("span",null,"Max Buyin"),A({id:"max-buyin-input",placeholder:"500",value:u.newSessionScreen.maxBuyin}))),g("div",null,g("input",{type:"submit",value:"Start Session"})))),A=({id:e,placeholder:t,value:n,min:s=1,max:i})=>g("NumberInput",{tagName:"input",id:e,type:"number",placeholder:t,pattern:"\\d*",value:n,min:s,max:i,required:!0});class I{constructor(e){this.session=e}drinkTips(){return`$${this.session.attributes.drinkTips??0}`}dealerTips(){return`$${this.session.attributes.dealerTips??0}`}blinds(){return`${this.session.attributes.smallBlind}/${this.session.attributes.bigBlind}`}maxBuyin(){return`$${this.session.attributes.maxBuyin} max`}title(){return[this.session.attributes.casinoName,this.blinds(),this.maxBuyin()].join(" ")}startTime(){return this.session.startTime?.toLocaleString()??""}profit(){return((this.session.attributes.cashoutAmount??0)-this.session.buyinsTotal()).toString()}timeElapsed(){return this.session.startTime?(e=>{let t=e/1e3;const n=Math.floor(t/3600),s=Math.floor((t-3600*n)/60);return t=Math.round(t-3600*n-60*s),`${n<10?`0${n}`:n.toString()}:${s<10?`0${s}`:s.toString()}:${t<10?`0${t}`:t.toString()}`})(Date.now()-this.session.startTime.getTime()):""}}class k{static create(e,n,s,i){const r=t();return u.sessions[r]={id:t(),casinoName:e,smallBlind:n,bigBlind:s,maxBuyin:i,notes:"",cashoutAmount:0,dealerTips:0,drinkTips:0,buyins:[]},new this(r)}constructor(e){if(this.id=e,!this.attributes)throw new Error(`Session ${e} does not exist`)}get attributes(){return u.sessions[this.id]}get startTime(){return this.attributes.startTime?new Date(this.attributes.startTime):null}get endTime(){return this.attributes.endTime?new Date(this.attributes.endTime):null}start(){if(this.startTime)throw new Error("Session already started");if(this.endTime)throw new Error("Session already ended");this.attributes.startTime=i(new Date),this.attributes.buyins.push({amount:this.attributes.maxBuyin,time:this.attributes.startTime})}rebuy(e){this.attributes.buyins.push({amount:e,time:(new Date).toISOString()})}rebuyMax(){this.rebuy(this.attributes.maxBuyin)}end(e,t){this.attributes.cashoutAmount=e,this.attributes.endTime=i(new Date),this.attributes.notes=t}undoEnd(){this.attributes.cashoutAmount=0,delete this.attributes.endTime}buyinsTotal(){return this.attributes.buyins.reduce(((e,t)=>e+t.amount),0)}updateTip(e,t){this.attributes[e]+t<0||(this.attributes[e]+=t)}updateDealerTip(e){this.updateTip("dealerTips",e)}updateDrinkTip(e){this.updateTip("drinkTips",e)}}const D=new class{constructor(e){this.appState=e}get currentSession(){return this.appState.currentSessionId&&this._cachedCurrentSessionId!==this.appState.currentSessionId&&(this._cachedCurrentSessionId=this.appState.currentSessionId,this._cachedCurrentSession=new k(this.appState.currentSessionId)),this._cachedCurrentSession}}(u),P=()=>{if(!D.currentSession)return null;const e=new I(D.currentSession);return g("ShowSessionScreen",{tagName:"div",id:"show-session-screen",className:"screen"},g("h1",{id:"session-title"},e.title()),g("div",null,g("span",null,`Profit: $${e.profit()}`)),g("div",null,g("span",null,`Start time: $${e.startTime()}`)),g("div",null,g("span",null,`Time elapsed: ${e.timeElapsed()}`)),g("form",{id:"rebuy-form",className:"section"},A({id:"rebuy-amount-input",placeholder:D.currentSession.attributes.maxBuyin.toString(),value:u.showSessionScreen.rebuyAmount}),g("input",{type:"submit",value:"Rebuy"}),g("input",{id:"rebuy-max-button",type:"button",value:"Max"})),C({type:"dealer",value:e.dealerTips()}),C({type:"drink",value:e.drinkTips()}),g("form",{id:"end-session-form",className:"section"},g("input",{className:"hidden",type:"text",autocomplete:"username"}),g("label",{className:"section"},g("div",null,"Notes"),g("textarea",{placeholder:"I punted againâ€¦",onInput:e=>{e.target&&(u.showSessionScreen.notes=e.target.value)}})),g("label",{className:"section"},g("div",null,"Cashout Amount"),A({min:0,id:"cashout-amount-input",placeholder:(3*D.currentSession.attributes.maxBuyin).toString()})),u.cachedAdminPassword?"":g("div",{id:"admin-password-area"},g("label",null,g("span",null,"Password")),g("input",{id:"admin-password-input",type:"password",autocomplete:"current-password",required:!0})),g("input",{id:"end-session-submit-button",type:"submit",value:"End Session",disabled:u.showSessionScreen.isSavingSession})))},C=({type:e,value:t})=>{return g("TipsSection",{tagName:"div",className:"section"},g("span",null,`${n=e,`${n[0].toUpperCase()}${n.slice(1)}`} tips: ${t}`),g("div",null,g("button",{className:"tip-button",id:`decrement-${e}-tip-button`},"-"),g("button",{className:"tip-button",id:`increment-${e}-tip-button`},"+")));var n},M="localhost"===window.location.hostname?r.Development:r.Production;const L=()=>{const e=k.create(u.newSessionScreen.casinoName,parseInt(u.newSessionScreen.smallBlind),parseInt(u.newSessionScreen.bigBlind),parseInt(u.newSessionScreen.maxBuyin));e.start(),(e=>{window.history.pushState({},"",`#/sessions/${e.id}`),u.currentSessionId=e.id,u.screen=a.ShowSession})(e)},O=async()=>{if(!D.currentSession)return;let e;D.currentSession.end(parseFloat(u.showSessionScreen.cashoutAmount),u.showSessionScreen.notes),u.showSessionScreen.isSavingSession=!0,B(d(),z);try{e=await U.saveSession(D.currentSession,u.cachedAdminPassword??u.showSessionScreen.adminPassword)}finally{u.showSessionScreen.isSavingSession=!1,B(d(),z)}e.ok?(u.cachedAdminPassword||(u.cachedAdminPassword=u.showSessionScreen.adminPassword),alert("Success!"),window.history.pushState({},"","#"),u.screen=a.Intro):(alert("Something went wrong."),D.currentSession.undoEnd())},_=e=>{if(!n(e.target))return!1;switch(e.target.id){case"new-session-button":return window.history.pushState({},"","#/sessions/new"),u.screen=a.NewSession,!0;case"decrement-dealer-tip-button":return D.currentSession?.updateDealerTip(-1),!0;case"increment-dealer-tip-button":return D.currentSession?.updateDealerTip(1),!0;case"decrement-drink-tip-button":return D.currentSession?.updateDrinkTip(-1),!0;case"increment-drink-tip-button":return D.currentSession?.updateDrinkTip(1),!0;case"rebuy-max-button":return D.currentSession?.rebuyMax(),!0}return!!(e.target.classList.contains("prefill-blinds")&&e.target.dataset.smallBlind&&e.target.dataset.bigBlind)&&(s=e.target.dataset.smallBlind,i=e.target.dataset.bigBlind,u.newSessionScreen.smallBlind=s,u.newSessionScreen.bigBlind=i,t=(100*parseInt(e.target.dataset.bigBlind)).toString(),u.newSessionScreen.maxBuyin=t,!0);var t,s,i},j=e=>{_(e)&&B(d(),z)},q=async e=>{if(!n(e.target))return!1;switch(e.preventDefault(),e.target.id){case"new-session-form":return L(),!0;case"rebuy-form":return D.currentSession&&(D.currentSession.rebuy(parseFloat(u.showSessionScreen.rebuyAmount)),u.showSessionScreen.rebuyAmount=""),!0;case"end-session-form":return await O(),!0}return!1},F=async e=>{await q(e)&&B(d(),z)},J=e=>{if(!e.target.type)return!1;const t=(e=>{switch(e){case"casino-name-input":return"newSessionScreen.casinoName";case"small-blind-input":return"newSessionScreen.smallBlind";case"big-blind-input":return"newSessionScreen.bigBlind";case"max-buyin-input":return"newSessionScreen.maxBuyin";case"max-players-input":return"newSessionScreen.maxPlayers";case"rebuy-amount-input":return"showSessionScreen.rebuyAmount";case"cashout-amount-input":return"showSessionScreen.cashoutAmount";case"admin-password-input":return"showSessionScreen.adminPassword"}})(e.target.id);return!!t&&((e,t,n)=>{if(!t)return;const i=t.split("."),r=i.pop();if(r){for(const t of i){const n=e[t];if(!s(n))return;e=n}e[r]=n}})(u,t,e.target.value)},R=e=>{J(e)&&B(d(),z)},U=new class{origin(){return M===r.Development?"http://localhost:3000":"https://blackjack-trainer-api.herokuapp.com"}request(e,t,n){const s=`${this.origin()}/api/v1${e}`;return window.fetch(s,{method:n.method,headers:{...n.headers,"Content-Type":"application/json"},body:JSON.stringify(t)})}post(e,t,n){return this.request(e,t,{method:"POST",...n})}saveSession(e,t){return this.post("/poker_sessions",{data:{type:"poker_session",attributes:e.attributes}},{headers:{"Poker-Sessions-Admin-Password":t}})}},z=document.getElementById("root");z&&(z.addEventListener("click",j),z.addEventListener("submit",F),z.addEventListener("input",R)),setInterval(l,1e4),document.addEventListener("visibilitychange",l),window.onbeforeunload=l,B(d(),z);
//# sourceMappingURL=index.9cb659f5.js.map
