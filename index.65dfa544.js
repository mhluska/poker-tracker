const e=Object.keys,t=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),s=e=>!!e.tagName,n=e=>"object"==typeof e&&!Array.isArray(e),i=e=>{const t=-e.getTimezoneOffset(),s=t>=0?"+":"-",n=e=>(e<10?"0":"")+e;return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+s+n(Math.floor(Math.abs(t)/60))+":"+n(Math.abs(t)%60)};let r,a;!function(e){e.Development="development",e.Production="production"}(r||(r={})),function(e){e.Intro="intro",e.NewSession="new-session",e.ShowSession="show-session"}(a||(a={}));const o=e=>e?"new"===e?a.NewSession:a.ShowSession:a.Intro,u={app:(()=>{const e=window.localStorage.getItem("pokerTracker"),t=e?JSON.parse(e):{},s=(()=>{const e=window.location.hash.match(/#\/sessions\/(.+)/);if(e)return e[1]})();return{screen:o(s),sessions:{},currentSessionId:s,showSessionScreen:{rebuyAmount:"",notes:"",cashoutAmount:"",adminPassword:"",isSavingSession:!1},newSessionScreen:{casinoName:"",smallBlind:"",bigBlind:"",maxBuyin:""},...t}})()},l=e=>{u.app=new Proxy(u.app,{get(e,t,s){if(!Reflect.has(e,t))return;const n=Reflect.get(e,t,s);return"object"==typeof n&&null!==n?new Proxy(n,this):n},set(t,s,n,i){const r=Reflect.set(t,s,n,i);return r&&e(),r}}),e()},p=()=>{window.localStorage.setItem("pokerTracker",JSON.stringify({sessions:u.app.sessions,cachedAdminPassword:u.app.cachedAdminPassword}))};let d;var c;let m;var h;(c=d||(d={}))[c.Element=1]="Element",c[c.Text=3]="Text",(h=m||(m={})).Value="value",h.ClassName="className";const S=new Set(Object.values(m)),b=new Map([["onInput","input"],["onClick","click"]]),w=e=>e.nodeType===d.Text,y=e=>"function"==typeof e.type,g=e=>!(e=>"String"===e.type)(e)&&!y(e);function f(e,t,...s){return"function"==typeof e?{type:e,props:t||{},children:[]}:{type:e,props:{...t,tagName:e||"div"},children:s.map((e=>"string"==typeof e?{type:"String",props:{value:e},children:[]}:e))}}const v=f,T=(e,t,s,n)=>{s!==n&&(s&&e.removeEventListener(t,s),n&&e.addEventListener(t,n))},B=(t,s,n)=>{if("String"===s?.type||"String"===n?.type)return;const i=s?e(s.props):[],r=n?e(n.props):[];for(const e of r.concat(i)){const i=s?.props[e],r=n?.props[e];if(S.has(e))t[e]=void 0===r?"":r;else if(i!==r)if("onClick"!==e&&"onInput"!==e)"boolean"==typeof r?r?t.setAttribute(e,""):t.removeAttribute(e):void 0===r?t.removeAttribute(e):t.setAttribute(e,String(r));else{const i=b.get(e);i&&T(t,i,s?.props[e],n?.props[e])}}},N=e=>{if(!e)return null;if("String"===e.type)return document.createTextNode(e.props.value);if(y(e))return N(e.type(e.props));const{children:t,type:s}=e,n=document.createElement(s);B(n,null,e);for(const e of t){if(!e)continue;const t=N(e);t&&n.appendChild(t)}return n},x=(e,t)=>{t&&e.parentElement?.replaceChild(t,e)},$=(e,t,s)=>{t.props.value!==s.props.value&&(e.nodeType===d.Element?x(e,N(s)):w(e)&&e.replaceData(0,e.length,s.props.value))},k=(e,t,s)=>{if(s)if(t&&t.type===s.type)if("String"!==t.type||"String"!==s.type){if(w(e))x(e,N(s));else if(y(t)&&y(s))k(e,t.type(t.props),s.type(s.props));else if(g(t)&&g(s)){B(e,t,s);const n=Array.from(e.childNodes).filter((e=>e.nodeType===d.Element||e.nodeType===d.Text));s.children.forEach(((s,i)=>{const r=n[i];if(r)k(r,t.children[i],s);else if(s){const t=N(s);t&&e.appendChild(t)}}))}}else $(e,t,s);else x(e,N(s));else e.remove()};let A=f("div");const E=({smallBlind:e,bigBlind:t})=>v("button",{type:"button",className:"prefill-blinds","data-small-blind":e,"data-big-blind":t},`${e}/${t}`),I=()=>v("div",{id:"intro-screen",className:"screen"},v("button",{id:"new-session-button"},"Start Session"));class D{static create(e,s,n,i){const r=t();return u.app.sessions[r]={id:t(),casinoName:e,smallBlind:s,bigBlind:n,maxBuyin:i,notes:"",cashoutAmount:0,dealerTips:0,drinkTips:0,buyins:[]},new this(r)}constructor(e){if(this.id=e,!this.attributes)throw new Error(`Session ${e} does not exist`)}get attributes(){return u.app.sessions[this.id]}get startTime(){return this.attributes.startTime?new Date(this.attributes.startTime):null}get endTime(){return this.attributes.endTime?new Date(this.attributes.endTime):null}start(){if(this.startTime)throw new Error("Session already started");if(this.endTime)throw new Error("Session already ended");this.attributes.startTime=i(new Date),this.attributes.buyins.push({amount:this.attributes.maxBuyin,time:this.attributes.startTime})}rebuy(e){this.attributes.buyins.push({amount:e,time:(new Date).toISOString()})}rebuyMax(){this.rebuy(this.attributes.maxBuyin)}end(e,t){this.attributes.cashoutAmount=e,this.attributes.endTime=i(new Date),this.attributes.notes=t}undoEnd(){this.attributes.cashoutAmount=0,delete this.attributes.endTime}buyinsTotal(){return this.attributes.buyins.reduce(((e,t)=>e+t.amount),0)}updateTip(e,t){this.attributes[e]+t<0||(this.attributes[e]+=t)}updateDealerTip(e){this.updateTip("dealerTips",e)}updateDrinkTip(e){this.updateTip("drinkTips",e)}}const C=new class{constructor(e){this.appState=e}get currentSession(){return this.appState.currentSessionId&&this._cachedCurrentSessionId!==this.appState.currentSessionId&&(this._cachedCurrentSessionId=this.appState.currentSessionId,this._cachedCurrentSession=new D(this.appState.currentSessionId)),this._cachedCurrentSession}get mostFrequentCasinoName(){if(this._cachedMostFrequentCasinoName)return this._cachedMostFrequentCasinoName;const e=Object.values(this.appState.sessions).sort(((e,t)=>e.endTime&&t.endTime?Date.parse(t.endTime)-Date.parse(e.endTime):1))[0]?.casinoName;return e&&(this._cachedMostFrequentCasinoName=e),e}}(u.app),P=()=>v("div",{id:"new-session-screen",className:"screen"},v(_,{onSelect:e=>{u.app.newSessionScreen.casinoName=e}}),v("form",{id:"new-session-form"},v("div",null,v("label",null,v("span",null,"Casino Name"),v("input",{id:"casino-name-input",type:"text",placeholder:C.mostFrequentCasinoName??"Bellagio",required:!0,value:u.app.newSessionScreen.casinoName}))),v("div",null,v("label",null,v("span",null,"Blinds"),v(M,{id:"small-blind-input",placeholder:"2",value:u.app.newSessionScreen.smallBlind,max:100}),v(M,{id:"big-blind-input",placeholder:"5",value:u.app.newSessionScreen.bigBlind,max:200})),v(E,{smallBlind:1,bigBlind:2}),v(E,{smallBlind:1,bigBlind:3}),v(E,{smallBlind:2,bigBlind:5}),v(E,{smallBlind:5,bigBlind:10})),v("div",null,v("label",null,v("span",null,"Max Buyin"),v(M,{id:"max-buyin-input",placeholder:"500",value:u.app.newSessionScreen.maxBuyin}))),v("div",null,v("input",{type:"submit",value:"Start Session"})))),M=({id:e,placeholder:t,value:s,min:n=1,max:i,onInput:r})=>v("input",{id:e,type:"number",placeholder:t,pattern:"\\d*",value:s,min:n,max:i,required:!0,onInput:r});class q{constructor(e){this.session=e}drinkTips(){return`$${this.session.attributes.drinkTips??0}`}dealerTips(){return`$${this.session.attributes.dealerTips??0}`}blinds(){return`${this.session.attributes.smallBlind}/${this.session.attributes.bigBlind}`}maxBuyin(){return`$${this.session.attributes.maxBuyin} max`}title(){return[this.session.attributes.casinoName,this.blinds(),this.maxBuyin()].join(" ")}startTime(){return this.session.startTime?.toLocaleString()??""}profit(){return((this.session.attributes.cashoutAmount??0)-this.session.buyinsTotal()).toString()}timeElapsed(){return this.session.startTime?(e=>{let t=e/1e3;const s=Math.floor(t/3600),n=Math.floor((t-3600*s)/60);return t=Math.round(t-3600*s-60*n),`${s<10?`0${s}`:s.toString()}:${n<10?`0${n}`:n.toString()}:${t<10?`0${t}`:t.toString()}`})(Date.now()-this.session.startTime.getTime()):""}}const O=()=>{if(!C.currentSession)return null;const e=new q(C.currentSession);return v("div",{id:"show-session-screen",className:"screen"},v("h1",{id:"session-title"},e.title()),v("div",null,v("span",null,`Profit: $${e.profit()}`)),v("div",null,v("span",null,`Start time: $${e.startTime()}`)),v("div",null,v("span",null,`Time elapsed: ${e.timeElapsed()}`)),v("form",{id:"rebuy-form",className:"section"},v(M,{id:"rebuy-amount-input",placeholder:C.currentSession.attributes.maxBuyin.toString(),value:u.app.showSessionScreen.rebuyAmount}),v("input",{type:"submit",value:"Rebuy"}),v("input",{id:"rebuy-max-button",type:"button",value:"Max"})),v(F,{type:"dealer",value:e.dealerTips()}),v(F,{type:"drink",value:e.drinkTips()}),v("form",{id:"end-session-form",className:"section"},v("input",{className:"hidden",type:"text",autocomplete:"username"}),v("label",{className:"section"},v("div",null,"Notes"),v("textarea",{onInput:e=>{e.target&&(u.app.showSessionScreen.notes=e.target.value)}})),v("label",{className:"section"},v("div",null,"Cashout Amount"),v(M,{min:0,value:u.app.showSessionScreen.cashoutAmount,placeholder:(3*C.currentSession.attributes.maxBuyin).toString(),onInput:e=>{e.target&&(u.app.showSessionScreen.cashoutAmount=e.target.value)}})),u.app.cachedAdminPassword?"":v("div",{id:"admin-password-area"},v("label",null,v("span",null,"Password")),v("input",{id:"admin-password-input",type:"password",autocomplete:"current-password",required:!0})),v("input",{id:"end-session-submit-button",type:"submit",value:"End Session",disabled:u.app.showSessionScreen.isSavingSession})))},F=({type:e,value:t})=>{return v("div",{className:"section"},v("span",null,`${s=e,`${s[0].toUpperCase()}${s.slice(1)}`} tips: ${t}`),v("div",null,v("button",{className:"tip-button",id:`decrement-${e}-tip-button`},"-"),v("button",{className:"tip-button",id:`increment-${e}-tip-button`},"+")));var s},_=({onSelect:e})=>{const t=C.mostFrequentCasinoName;return t?v("div",null,`Play at ${t} again?`,v("button",{onClick:()=>e(t)},"OK")):null},j="localhost"===window.location.hostname?r.Development:r.Production;const L=()=>{const e=D.create(u.app.newSessionScreen.casinoName,parseInt(u.app.newSessionScreen.smallBlind),parseInt(u.app.newSessionScreen.bigBlind),parseInt(u.app.newSessionScreen.maxBuyin));e.start(),(e=>{window.history.pushState({},"",`#/sessions/${e.id}`),u.app.currentSessionId=e.id,u.app.screen=a.ShowSession})(e)},R=async()=>{if(!C.currentSession)return;let e;C.currentSession.end(parseFloat(u.app.showSessionScreen.cashoutAmount),u.app.showSessionScreen.notes),u.app.showSessionScreen.isSavingSession=!0;try{e=await H.saveSession(C.currentSession,u.app.cachedAdminPassword??u.app.showSessionScreen.adminPassword)}finally{u.app.showSessionScreen.isSavingSession=!1}e.ok?(u.app.cachedAdminPassword||(u.app.cachedAdminPassword=u.app.showSessionScreen.adminPassword),alert("Success!"),window.history.pushState({},"","#"),u.app.screen=a.Intro):(alert("Something went wrong."),C.currentSession.undoEnd())},J=e=>{if(s(e.target)){switch(e.target.id){case"new-session-button":return window.history.pushState({},"","#/sessions/new"),void(u.app.screen=a.NewSession);case"decrement-dealer-tip-button":return void C.currentSession?.updateDealerTip(-1);case"increment-dealer-tip-button":return void C.currentSession?.updateDealerTip(1);case"decrement-drink-tip-button":return void C.currentSession?.updateDrinkTip(-1);case"increment-drink-tip-button":return void C.currentSession?.updateDrinkTip(1);case"rebuy-max-button":return void C.currentSession?.rebuyMax()}var t,n,i;e.target.classList.contains("prefill-blinds")&&e.target.dataset.smallBlind&&e.target.dataset.bigBlind&&(n=e.target.dataset.smallBlind,i=e.target.dataset.bigBlind,u.app.newSessionScreen.smallBlind=n,u.app.newSessionScreen.bigBlind=i,t=(100*parseInt(e.target.dataset.bigBlind)).toString(),u.app.newSessionScreen.maxBuyin=t)}},U=e=>{if(s(e.target))switch(e.preventDefault(),e.target.id){case"new-session-form":L();break;case"rebuy-form":C.currentSession&&(C.currentSession.rebuy(parseFloat(u.app.showSessionScreen.rebuyAmount)),u.app.showSessionScreen.rebuyAmount="");break;case"end-session-form":R()}},z=e=>{if(!e.target.type)return;const t=(e=>{switch(e){case"casino-name-input":return"newSessionScreen.casinoName";case"small-blind-input":return"newSessionScreen.smallBlind";case"big-blind-input":return"newSessionScreen.bigBlind";case"max-buyin-input":return"newSessionScreen.maxBuyin";case"max-players-input":return"newSessionScreen.maxPlayers";case"rebuy-amount-input":return"showSessionScreen.rebuyAmount";case"admin-password-input":return"showSessionScreen.adminPassword"}})(e.target.id);return t?((e,t,s)=>{if(!t)return;const i=t.split("."),r=i.pop();if(r){for(const t of i){const s=e[t];if(!n(s))return;e=s}e[r]=s}})(u.app,t,e.target.value):void 0},H=new class{origin(){return j===r.Development?"http://localhost:3000":"https://blackjack-trainer-api.herokuapp.com"}request(e,t,s){const n=`${this.origin()}/api/v1${e}`;return window.fetch(n,{method:s.method,headers:{...s.headers,"Content-Type":"application/json"},body:JSON.stringify(t)})}post(e,t,s){return this.request(e,t,{method:"POST",...s})}saveSession(e,t){return this.post("/poker_sessions",{data:{type:"poker_session",attributes:e.attributes}},{headers:{"Poker-Sessions-Admin-Password":t}})}},K=document.getElementById("root");K&&(l((()=>((e,t)=>{if(!e)throw new Error("component is null");if(!t)throw new Error("appRoot is not set");if(!t.parentElement)throw new Error("appRoot not attached to DOM");const s=f("div",null,e);k(t,A,s),A=s})((()=>{switch(u.app.screen){case a.Intro:return I();case a.NewSession:return P();case a.ShowSession:return O();default:throw new Error(`Unknown screen ${u.app.screen}`)}})(),K))),K.addEventListener("click",J),K.addEventListener("submit",U),K.addEventListener("input",z)),setInterval(p,1e4),document.addEventListener("visibilitychange",p),window.onbeforeunload=p;
//# sourceMappingURL=index.65dfa544.js.map
